<?xml version="1.0"?>

<!-- Boeing 737 Electrical System -->

<system name="B737: Electrical">

	<property value="0">/systems/electrical/bus/ac-tie</property>
	<property value="0">/systems/electrical/bus/dc-tie</property>
	<property value="0">/systems/electrical/bus/ac-gen-l-src</property>
	<property value="0">/systems/electrical/bus/ac-gen-r-src</property>
	<property value="0">/systems/electrical/sources/bat-charger-powered</property>
	<property value="0">/systems/electrical/sources/bat-1/amp</property>
	<property value="99.9">/systems/electrical/sources/bat-1/percent</property>
	<property value="0">/systems/electrical/sources/bat-2/amp</property>
	<property value="99.9">/systems/electrical/sources/bat-2/percent</property>

	<channel name="Main Electrical" execrate="8">

		<!-- Battery 1 -->
		<switch name="/systems/electrical/sources/bat-1/charge">
			<default value="0" />
			<test logic="AND" value="1">
				/systems/electrical/sources/bat-charger-powered eq 1
				/controls/elec/batt-on eq 1
				/systems/failures/electrical/battery ne 1
			</test>
		</switch>

		<switch name="/systems/electrical/sources/bat-1/discharge">
			<default value="0" />
			<test logic="AND" value="1">
				/systems/electrical/sources/bat-1/amp gt 0
				/controls/elec/batt-on eq 1
				/systems/failures/electrical/battery ne 1
			</test>
		</switch>

		<switch name="/systems/electrical/sources/bat-1/direction">
			<default value="0" />
			<test logic="AND" value="-1"><!-- Charge --> /systems/electrical/sources/bat-1/percent le 99.9
				/systems/electrical/sources/bat-1/charge eq 1 </test>
			<test logic="AND" value="0">
				/systems/electrical/sources/bat-1/charge eq 1
			</test>
			<test logic="AND" value="1"><!-- Discharge --> /systems/electrical/sources/bat-1/percent gt 5
				/systems/electrical/sources/bat-1/discharge eq 1 </test>
		</switch>

		<fcs_function name="/systems/electrical/sources/bat-1/percent-calc">
			<function>
				<ifthen>
					<eq>
						<property>/systems/electrical/sources/bat-1/direction</property>
						<value>0</value>
					</eq>
					<property>/systems/electrical/sources/bat-1/percent</property>
					<ifthen>
						<eq>
							<property>/systems/electrical/sources/bat-1/direction</property>
							<value>-1</value>
						</eq>
						<sum>
							<property>/systems/electrical/sources/bat-1/percent</property>
							<product>
								<quotient>
									<value>2.25</value>
									<sum>
										<property>/systems/electrical/sources/bat-1/percent</property>
										<value>1</value>
									</sum>
								</quotient>
								<property>simulation/channel-dt</property>
							</product>
						</sum>
						<sum>
							<property>/systems/electrical/sources/bat-1/percent</property>
							<product>
								<quotient>
									<value>-0.75</value>
									<sum>
										<property>/systems/electrical/sources/bat-1/percent</property>
										<value>1</value>
									</sum>
								</quotient>
								<property>simulation/channel-dt</property>
							</product>
						</sum>
					</ifthen>
				</ifthen>
			</function>
			<output>/systems/electrical/sources/bat-1/percent</output>
		</fcs_function>

		<fcs_function name="/systems/electrical/sources/bat-1/volt">
			<function>
				<table>
					<independentVar lookup="row">/systems/electrical/sources/bat-1/percent</independentVar>
					<independentVar lookup="column">/systems/failures/electrical/battery</independentVar>
					<tableData>
						0 1
						0 0 0
						10 22 2
						100 30 4
					</tableData>
				</table>
			</function>
		</fcs_function>

		<switch name="/systems/electrical/sources/bat-1/amp">
			<default value="0" />
			<test logic="AND" value="2">
				/controls/elec/batt-on eq 1
				/systems/electrical/sources/bat-1/volt ge 10
			</test>
		</switch>

		<!-- Battery 2 -->
		<switch name="/systems/electrical/sources/bat-2/charge">
			<default value="0" />
			<test logic="AND" value="1">
				/systems/electrical/sources/bat-charger-powered eq 1
				/controls/elec/batt-on eq 1
				/systems/failures/electrical/battery ne 1
			</test>
		</switch>

		<switch name="/systems/electrical/sources/bat-2/discharge">
			<default value="0" />
			<test logic="AND" value="1">
				/systems/electrical/sources/bat-2/amp gt 0
				/controls/elec/batt-on eq 1
				/systems/failures/electrical/battery ne 1
			</test>
		</switch>

		<switch name="/systems/electrical/sources/bat-2/direction">
			<default value="0" />
			<test logic="AND" value="-1"><!-- Charge --> /systems/electrical/sources/bat-2/percent le 99.9
				/systems/electrical/sources/bat-2/charge eq 1 </test>
			<test logic="AND" value="0">
				/systems/electrical/sources/bat-2/charge eq 1
			</test>
			<test logic="AND" value="1"><!-- Discharge --> /systems/electrical/sources/bat-2/percent gt 5
				/systems/electrical/sources/bat-2/discharge eq 1 </test>
		</switch>

		<fcs_function name="/systems/electrical/sources/bat-2/percent-calc">
			<function>
				<ifthen>
					<eq>
						<property>/systems/electrical/sources/bat-2/direction</property>
						<value>0</value>
					</eq>
					<property>/systems/electrical/sources/bat-2/percent</property>
					<ifthen>
						<eq>
							<property>/systems/electrical/sources/bat-2/direction</property>
							<value>-1</value>
						</eq>
						<sum>
							<property>/systems/electrical/sources/bat-2/percent</property>
							<product>
								<quotient>
									<value>2.25</value>
									<sum>
										<property>/systems/electrical/sources/bat-2/percent</property>
										<value>1</value>
									</sum>
								</quotient>
								<property>simulation/channel-dt</property>
							</product>
						</sum>
						<sum>
							<property>/systems/electrical/sources/bat-2/percent</property>
							<product>
								<quotient>
									<value>-0.75</value>
									<sum>
										<property>/systems/electrical/sources/bat-2/percent</property>
										<value>1</value>
									</sum>
								</quotient>
								<property>simulation/channel-dt</property>
							</product>
						</sum>
					</ifthen>
				</ifthen>
			</function>
			<output>/systems/electrical/sources/bat-2/percent</output>
		</fcs_function>

		<fcs_function name="/systems/electrical/sources/bat-2/volt">
			<function>
				<table>
					<independentVar lookup="row">/systems/electrical/sources/bat-2/percent</independentVar>
					<independentVar lookup="column">/systems/failures/electrical/battery</independentVar>
					<tableData>
						0 1
						0 0 0
						10 22 2
						100 30 3
					</tableData>
				</table>
			</function>
		</fcs_function>

		<!-- IDG Engine 1 -->
		<pure_gain name="/systems/electrical/sources/idg-l/drive-rpm-input">
			<input>/engines/engine[0]/n2-actual</input>
			<gain>50.33</gain><!-- Ratio of ~6000 and max N2 -->
		</pure_gain>

		<pure_gain name="/systems/electrical/sources/idg-l/drive-rpm">
			<input>/systems/electrical/sources/idg-l/drive-rpm-input</input>
			<gain>/controls/elec/csd-l-conn</gain>
		</pure_gain>

		<fcs_function name="/systems/electrical/sources/idg-l/csd-gearbox-ratio-cmd">
			<function>
				<quotient>
					<value>6000</value>
					<property>/systems/electrical/sources/idg-l/drive-rpm</property>
				</quotient>
			</function>
			<clipto>
				<min>1.1</min>
				<max>3.03</max>
			</clipto>
		</fcs_function>

		<lag_filter name="/systems/electrical/sources/idg-l/csd-gearbox-ratio">
			<input>/systems/electrical/sources/idg-l/csd-gearbox-ratio-cmd</input>
			<c1>40</c1>
		</lag_filter>

		<pure_gain name="/systems/electrical/sources/idg-l/csd-rpm">
			<input>/systems/electrical/sources/idg-l/drive-rpm</input>
			<gain>/systems/electrical/sources/idg-l/csd-gearbox-ratio</gain>
		</pure_gain>

		<fcs_function name="/systems/electrical/sources/idg-l/pmg-volt">
			<function>
				<product>
					<property>/systems/electrical/sources/idg-l/csd-rpm</property>
					<quotient>
						<value>115</value>
						<value>6000</value>
					</quotient>
				</product>
			</function>
		</fcs_function>

		<fcs_function name="/systems/electrical/sources/idg-l/pmg-hertz">
			<function>
				<quotient>
					<product>
						<property>/systems/electrical/sources/idg-l/csd-rpm</property>
						<value>8</value><!-- Number of poles in generator -->
					</product>
					<value>120</value>
				</quotient>
			</function>
		</fcs_function>

		<switch name="/systems/electrical/sources/idg-l/gcr-relay">
			<default value="0" />
			<test value="1">
				/systems/failures/electrical/gen-l ne 1
			</test>
		</switch>

		<pure_gain name="/systems/electrical/sources/idg-l/output-volt">
			<input>/systems/electrical/sources/idg-l/pmg-volt</input>
			<gain>/systems/electrical/sources/idg-l/gcr-relay</gain>
		</pure_gain>

		<pure_gain name="/systems/electrical/sources/idg-l/output-hertz">
			<input>/systems/electrical/sources/idg-l/pmg-hertz</input>
			<gain>/systems/electrical/sources/idg-l/gcr-relay</gain>
		</pure_gain>

		<!-- IDG Engine 2 -->
		<pure_gain name="/systems/electrical/sources/idg-r/drive-rpm-input">
			<input>/engines/engine[1]/n2-actual</input>
			<gain>50.33</gain><!-- Ratio of ~6000 and max N2 -->
		</pure_gain>

		<pure_gain name="/systems/electrical/sources/idg-r/drive-rpm">
			<input>/systems/electrical/sources/idg-r/drive-rpm-input</input>
			<gain>/controls/elec/csd-r-conn</gain>
		</pure_gain>

		<fcs_function name="/systems/electrical/sources/idg-r/csd-gearbox-ratio-cmd">
			<function>
				<quotient>
					<value>6000</value>
					<property>/systems/electrical/sources/idg-r/drive-rpm</property>
				</quotient>
			</function>
			<clipto>
				<min>1.1</min>
				<max>2.7</max>
			</clipto>
		</fcs_function>

		<lag_filter name="/systems/electrical/sources/idg-r/csd-gearbox-ratio">
			<input>/systems/electrical/sources/idg-r/csd-gearbox-ratio-cmd</input>
			<c1>40</c1>
		</lag_filter>

		<pure_gain name="/systems/electrical/sources/idg-r/csd-rpm">
			<input>/systems/electrical/sources/idg-r/drive-rpm</input>
			<gain>/systems/electrical/sources/idg-r/csd-gearbox-ratio</gain>
		</pure_gain>

		<fcs_function name="/systems/electrical/sources/idg-r/pmg-volt">
			<function>
				<product>
					<property>/systems/electrical/sources/idg-r/csd-rpm</property>
					<quotient>
						<value>115</value>
						<value>6000</value>
					</quotient>
				</product>
			</function>
		</fcs_function>

		<fcs_function name="/systems/electrical/sources/idg-r/pmg-hertz">
			<function>
				<quotient>
					<product>
						<property>/systems/electrical/sources/idg-r/csd-rpm</property>
						<value>8</value><!-- Number of poles in generator -->
					</product>
					<value>120</value>
				</quotient>
			</function>
		</fcs_function>

		<switch name="/systems/electrical/sources/idg-r/gcr-relay">
			<default value="0" />
			<test value="1">
				/systems/failures/electrical/gen-r ne 1
			</test>
		</switch>

		<pure_gain name="/systems/electrical/sources/idg-r/output-volt">
			<input>/systems/electrical/sources/idg-r/pmg-volt</input>
			<gain>/systems/electrical/sources/idg-r/gcr-relay</gain>
		</pure_gain>

		<pure_gain name="/systems/electrical/sources/idg-r/output-hertz">
			<input>/systems/electrical/sources/idg-r/pmg-hertz</input>
			<gain>/systems/electrical/sources/idg-r/gcr-relay</gain>
		</pure_gain>

		<!-- APU Gen -->
		<scheduled_gain name="/systems/electrical/sources/apu/drive-rpm">
			<input>/engines/engine[2]/n1-actual</input>
			<table><!-- 115v 8000rpm at 98.6% -->
				<independentVar lookup="row">/engines/engine[2]/n1-actual</independentVar>
				<tableData><!-- 112v avail at 95% --> 95.0 82.02 98.6 81.14 </tableData>
			</table>
		</scheduled_gain>

		<fcs_function name="/systems/electrical/sources/apu/pmg-volt">
			<function>
				<product>
					<property>/systems/electrical/sources/apu/drive-rpm</property>
					<quotient>
						<value>115</value>
						<value>8000</value>
					</quotient>
				</product>
			</function>
		</fcs_function>

		<fcs_function name="/systems/electrical/sources/apu/pmg-hertz">
			<function>
				<quotient>
					<product>
						<property>/systems/electrical/sources/apu/drive-rpm</property>
						<value>2</value><!-- Number of poles in generator -->
					</product>
					<value>120</value>
				</quotient>
			</function>
		</fcs_function>

		<switch name="/systems/electrical/sources/apu/gcr-relay">
			<default value="0" />
			<test value="1">
				/systems/failures/electrical/apu ne 1
			</test>
		</switch>

		<pure_gain name="/systems/electrical/sources/apu/output-volt">
			<input>/systems/electrical/sources/apu/pmg-volt</input>
			<gain>/systems/electrical/sources/apu/gcr-relay</gain>
		</pure_gain>

		<pure_gain name="/systems/electrical/sources/apu/output-hertz">
			<input>/systems/electrical/sources/apu/pmg-hertz</input>
			<gain>/systems/electrical/sources/apu/gcr-relay</gain>
		</pure_gain>

		<!-- External Power -->
		<fcs_function name="/systems/electrical/sources/ext/output-volt">
			<function>
				<ifthen>
					<eq>
						<property>/controls/elec/grd-power</property>
						<value>1</value>
					</eq>
					<value>115</value>
					<value>0</value>
				</ifthen>
			</function>
		</fcs_function>

		<fcs_function name="/systems/electrical/sources/ext/output-hertz">
			<function>
				<ifthen>
					<ge>
						<property>/systems/electrical/sources/ext/output-volt</property>
						<value>112</value>
					</ge>
					<value>400</value>
					<value>0</value>
				</ifthen>
			</function>
		</fcs_function>
	</channel>
</system>